<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="How to Efficiently Serve an LLM?" />
<meta name="author" content="Tremo Ahmed" />
<meta property="og:locale" content="en" />
<meta name="description" content="Exploring LLM serving optimizations including batching, quantization, paged attention, speculative decoding, and KV cache techniques." />
<meta property="og:description" content="Exploring LLM serving optimizations including batching, quantization, paged attention, speculative decoding, and KV cache techniques." />
<link rel="canonical" href="http://localhost:4000/posts/How-to-Efficiently-serve-an-llm/" />
<meta property="og:url" content="http://localhost:4000/posts/How-to-Efficiently-serve-an-llm/" />
<meta property="og:site_name" content="Tremo Ahmed" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-08-05T05:30:00+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How to Efficiently Serve an LLM?" />
<meta name="twitter:site" content="@tremooo" />
<meta name="twitter:creator" content="@tremooo" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Tremo Ahmed","url":"https://www.linkedin.com/in/tremo1/"},"dateModified":"2024-08-05T05:30:00+03:00","datePublished":"2024-08-05T05:30:00+03:00","description":"Exploring LLM serving optimizations including batching, quantization, paged attention, speculative decoding, and KV cache techniques.","headline":"How to Efficiently Serve an LLM?","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/How-to-Efficiently-serve-an-llm/"},"url":"http://localhost:4000/posts/How-to-Efficiently-serve-an-llm/"}</script>
<!-- End Jekyll SEO tag -->


  <title>How to Efficiently Serve an LLM? | Tremo Ahmed
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">



  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/personal/ahmedtremo.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">Tremo Ahmed</a>
    <p class="site-subtitle fst-italic mb-0">Research Engineer @ Meta | AI Infra</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
          
      

      
        <a
          href="https://www.linkedin.com/in/tremo1"
          aria-label="linkedin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-linkedin"></i>
        </a>
      
    

      
        <a
          href="https://github.com/tremo1"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    

      
        <a
          href="https://twitter.com/tremooo"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-twitter"></i>
        </a>
      
    

      
        <a
          href="javascript:location.href = 'mailto:' + ['me','tremo.uk'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
          
        

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>How to Efficiently Serve an LLM?</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>How to Efficiently Serve an LLM?</h1>
    
      <p class="post-desc fw-light mb-4">Exploring LLM serving optimizations including batching, quantization, paged attention, speculative decoding, and KV cache techniques.</p>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1722825000"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Aug  5, 2024
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                <a href="https://www.linkedin.com/in/tremo1/">Tremo Ahmed</a>
                
              
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="892 words"
>
  <em>4 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">How to Efficiently Serve an LLM?</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">How to Efficiently Serve an LLM?</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <h2 id="how-to-efficiently-serve-an-llm"><span class="me-2">How to Efficiently Serve an LLM</span><a href="#how-to-efficiently-serve-an-llm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>LLMs, or <strong>Large</strong> Language Models, are named so because they can range from tens to hundreds of billions of parameters. Their utility is clear, as LLMs are setting new records on various benchmarks and now often match or exceed human performance in multiple tasks <a href="https://arxiv.org/html/2303.08774v4">GPT-4 Technical Report</a>. Consequently, many companies are eager to deploy them in production. However, due to the unprecedented size of LLMs, there are significant challenges in serving them, such as slow token generation (tokens/second), memory limits for loading model parameters, KV cache (explained later), compute limits, and more. In this article, we will cover several recent ideas to help set up a robust LLM serving system.</p>

<p><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/inference-engines-and-servers-architecture.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/inference-engines-and-servers-architecture.png" alt="LLM Serving Overview" loading="lazy"></a><strong>LLM Serving Overview</strong></p>

<h2 id="llm-inference-steps"><span class="me-2">LLM inference Steps</span><a href="#llm-inference-steps" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<ol>
  <li>Multiple users send requests to the LLM Server through HTTPs/gRPC.</li>
  <li>The LLM Server receives the requests and schedules them based on QoE definition.
    <ul>
      <li><strong>QoE (Quality of Experience)</strong>: Defined by two metrics:
        <ul>
          <li><strong>TTFT (Time to First Token)</strong>: The time it takes for a user to receive the first response token.</li>
          <li><strong>TDS (Token Delivery Speed)</strong>: The rate at which the user receives tokens, which should be uniform and above the reader’s reading speed for a positive user experience.</li>
        </ul>
      </li>
    </ul>

    <p><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/QoE%20Intro.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/QoE%20Intro.png" alt="QoE" loading="lazy"></a><strong>QoE Aware LLM Serving</strong></p>
  </li>
  <li>After scheduling, the LLM Inference process is divided into two phases:
    <ul>
      <li>
        <p><strong>Prefill phase</strong>: The LLM processes the input tokens in parallel and generates the output activations known as the “KV Cache”. This step is highly efficient at utilizing the GPU’s parallel processing capabilities, making input tokens generally much cheaper than output tokens (as seen in the GPT-4o pricing chart). This phase produces the first output token and is typically compute-bound.</p>
      </li>
      <li>
        <p><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/gpt-4o%20pricing.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/gpt-4o%20pricing.png" alt="gpt-4o pricing" loading="lazy"></a>
<strong>GPT-4o Pricing</strong></p>
      </li>
      <li>
        <p><strong>Decode phase</strong>: The LLM starts autoregressively generating output tokens one at a time. This phase is slower in terms of inference and is where optimizations are <strong>necessary</strong>. Output tokens at each step are concatenated with the previous tokens’ KV cache to generate the next token.</p>
      </li>
      <li>
        <p><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/KV%20Caching%20explanation%20&amp;%20reuse.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/KV%20Caching%20explanation%20&amp;%20reuse.png" alt="KV Cache" loading="lazy"></a>
<strong>KV Cache Explanation &amp; Reuse</strong></p>
      </li>
    </ul>
  </li>
</ol>

<h2 id="optimizations"><span class="me-2">Optimizations</span><a href="#optimizations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Many experts are innovating the inference stack, and multiple startups are competing to reduce costs to attract more customers.</p>

<ul>
  <li><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/Llama%20405%20pricing%20by%20different%20providers.jpg" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/Llama%20405%20pricing%20by%20different%20providers.jpg" alt="llama405-pricing" loading="lazy"></a><strong>LLAMA 405 Pricing by Different Providers</strong></li>
</ul>

<p>Here are some interesting optimizations shared recently in research:</p>

<ol>
  <li><strong>Batching</strong>:
    <ul>
      <li>Instead of serving one request at a time and wasting compute resources (since the decode phase has low arithmetic intensity and is memory-bound), we can amortize the cost of retrieving weights and KV cache from memory by serving multiple requests simultaneously.</li>
      <li><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/continuous-batching.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/continuous-batching.png" alt="Continuous Batching" loading="lazy"></a><strong>Continuous Batching</strong></li>
    </ul>
  </li>
  <li><strong>Model Quantization (FP8/INT8)</strong>:
    <ul>
      <li>Decreasing the precision of model weights and/or activations (<a href="https://arxiv.org/abs/2306.00978">AWQ</a>/<a href="https://arxiv.org/abs/2210.17323">GPTQ</a>) frees up more GPU VRAM, which allows for serving larger batches of requests.</li>
      <li><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/Quantaization.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/Quantaization.png" alt="Model Quantization" loading="lazy"></a><strong>Model Quantization</strong></li>
    </ul>
  </li>
  <li><strong>Paged Attention</strong>:
    <ul>
      <li>The core idea behind <a href="https://docs.vllm.ai/en/latest/index.html">vLLM</a>, the most popular open-source serving engine, is to avoid memory fragmentation that occurs due to preserving the max context length for every request by using paging (borrowed from OS paging) to manage memory efficiently.</li>
      <li><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/PagedAttention%20VLLM.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/PagedAttention%20VLLM.png" alt="Paged Attention" loading="lazy"></a>
<strong>Paged Attention in vLLM</strong></li>
    </ul>
  </li>
  <li><strong>Prefill Chunking / Stale-free Batching</strong>:
    <ul>
      <li>Proposed by the <a href="https://www.usenix.org/system/files/osdi24-agrawal.pdf">Sarathi-Serve paper</a>, dividing the prefill context into smaller chunks allows merging the prefill and decode phases of different requests in the same batch.</li>
      <li><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/Prefill%20decode%20prioritizing.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/Prefill%20decode%20prioritizing.png" alt="Sarathi-Serve" loading="lazy"></a>
<strong>Prefill Decode Prioritizing</strong></li>
    </ul>
  </li>
  <li><strong>Prefill/Decode Disaggregation</strong>:
    <ul>
      <li>In constrast to the previous idea, this paper <a href="https://arxiv.org/pdf/2407.00079">Mooncake: A KVCache-centric Disaggregated
Architecture for LLM Serving</a> proposes separating the prefill and decode phases and transferring KVCache through a specialized design.</li>
      <li><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/KVCache%20transfer%20in%20disaggregated%20arch.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/KVCache%20transfer%20in%20disaggregated%20arch.png" alt="KVCache transfer in disaggregated arch" loading="lazy"></a>
<strong>KVCache Transfer in Disaggregated Architecture</strong></li>
    </ul>
  </li>
  <li><strong>KVCache Compression</strong>:
    <ul>
      <li>As proposed by <a href="https://arxiv.org/pdf/2310.07240">CacheGen</a>, compressing the KVCache to speed up network transfer. This approach is beneficial for use cases with large context lengths (i.e., content summarization) which are over 16k input tokens to justify the encoding/decoding CPU overhead.</li>
      <li><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/KV%20Compression.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/KV%20Compression.png" alt="KVCache Compression" loading="lazy"></a>
<strong>KV Cache Compression</strong></li>
    </ul>
  </li>
  <li><strong>Speculative Decoding</strong>:
    <ul>
      <li>Using extra smaller model(s) that generate tokens fast and in parallel. Selecting the output that matches the original model can speed up inference for simple use cases. <strong>Note that</strong> as the request batch size increases, the speed-up of speculative decoding diminishes.</li>
      <li><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/Speculative%20Decoding.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/Speculative%20Decoding.png" alt="Speculative Decoding" loading="lazy"></a><strong>Speculative Decoding</strong></li>
    </ul>
  </li>
  <li><strong>Radix Attention (Prefix Caching)</strong>:
    <ul>
      <li>This is the idea behind SGLang (<a href="https://arxiv.org/pdf/2312.07104">SGLang: Efficient Execution of
Structured Language Model Programs</a>), which involves creating a data structure similar to a Prefix tree (Trie) for the KVCache to help reuse KVCache without recomputation. This only works for some use cases, like those shown in the image below:</li>
      <li><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/KV%20Cache%20sharing%20examples.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/KV%20Cache%20sharing%20examples.png" alt="Radix Attention" loading="lazy"></a><strong>KV Cache Sharing Examples</strong></li>
    </ul>
  </li>
  <li><strong>Early Rejection</strong>:
    <ul>
      <li>Predicting if a request can be served once received to avoid wasted resources (i.e., the server successfully computed the prefill part but failed at the decode phase due to memory limitations) will help improve server resource utilization and prevent downtime.</li>
      <li><a href="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/Early%20Rejection%20based%20on%20prediction.png" class="popup img-link shimmer"><img src="/assets/img/posts/2024-08-05-How-to-Efficiently-serve-an-llm/Early%20Rejection%20based%20on%20prediction.png" alt="Early Rejection" loading="lazy"></a><strong>Early Rejection based on Prediction</strong></li>
    </ul>
  </li>
</ol>

<h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Efficiently serving large language models is essential for businesses to reduce costs and increase generation speed (tokens/second). This efficiency opens the door for more use cases for LLMs. With the ideas presented here, you can optimize your LLM inference stack to achieve these goals and more!</p>

<h2 id="references"><span class="me-2">References</span><a href="#references" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<ol>
  <li><a href="https://www.usenix.org/system/files/osdi24-agrawal.pdf">Improving LLM Inference with Prefill Chunking / Stale-free batching (USENIX)</a></li>
  <li><a href="https://arxiv.org/pdf/2407.00079">Mooncake: A KVCache-centric Disaggregated
Architecture for LLM Serving</a></li>
  <li><a href="https://arxiv.org/pdf/2310.07240">KVCache Compression and Streaming for Faster LLM Serving (arXiv)</a></li>
  <li><a href="https://arxiv.org/pdf/2405.04437">Dynamic Memory Management for LLMs: vAttention (arXiv)</a></li>
  <li><a href="https://arxiv.org/pdf/2404.16283">Enhancing Quality-of-Experience in LLM-Based Services (arXiv)</a></li>
  <li><a href="https://arxiv.org/pdf/2312.07104">Prefix Caching for Efficient LLM Inference (arXiv)</a></li>
  <li><a href="https://developer.nvidia.com/blog/mastering-llm-techniques-inference-optimization/">Mastering LLM Techniques: Inference Optimization (NVIDIA Technical Blog)</a></li>
  <li><a href="https://huggingface.co/spaces/osanseviero/token_probability_distribution">Token Probability Distribution (Hugging Face)</a></li>
  <li><a href="https://docs.vllm.ai/en/stable/">Welcome to vLLM! — vLLM Documentation</a></li>
  <li><a href="https://www.run.ai/blog/serving-large-language-models">Serving Large Language Models: Technologies and Choices (run.ai)</a></li>
  <li><a href="https://arxiv.org/pdf/2402.16363">Efficient Large Language Model Serving (arXiv)</a></li>
</ol>

<hr />

<p><strong>Related:</strong> If you’re interested in the training side of LLMs, check out my post on <a href="/posts/What-Infra-does-it-take-to-train-llama405b/">What Infrastructure does it take to train a 405B Llama3-like model?</a></p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/llm/">LLM</a>,
          <a href="/categories/inference/">Inference</a>,
          <a href="/categories/optimization/">Optimization</a>,
          <a href="/categories/serving/">Serving</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/llm/"
            class="post-tag no-text-decoration"
          >LLM</a>
        
          <a
            href="/tags/inference/"
            class="post-tag no-text-decoration"
          >inference</a>
        
          <a
            href="/tags/optimization/"
            class="post-tag no-text-decoration"
          >optimization</a>
        
          <a
            href="/tags/serving/"
            class="post-tag no-text-decoration"
          >serving</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://www.linkedin.com/sharing/share-offsite/?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHow-to-Efficiently-serve-an-llm%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin">
        <i class="fa-fw fab fa-linkedin"></i>
      </a>
    

      

      <a href="https://twitter.com/intent/tweet?text=How%20to%20Efficiently%20Serve%20an%20LLM?%20-%20Tremo%20Ahmed&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHow-to-Efficiently-serve-an-llm%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fab fa-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=How%20to%20Efficiently%20Serve%20an%20LLM?%20-%20Tremo%20Ahmed&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHow-to-Efficiently-serve-an-llm%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHow-to-Efficiently-serve-an-llm%2F&text=How%20to%20Efficiently%20Serve%20an%20LLM?%20-%20Tremo%20Ahmed" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Spegel-stateless-local-OCI-mirror/">Spegel - Stateless Local OCI Mirror</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/How-to-Efficiently-serve-an-llm/">How to Efficiently Serve an LLM?</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/What-Infra-does-it-take-to-train-llama405b/">What Infrastructure does it take to train a 405B Llama3-like model?</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/the-tech-behind-tiktoks-addictive-recommendation-system/">The Tech Behind TikTok's Addictive Recommendation System</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/do-you-really-need-a-vector-database/">Do you really need a Vector Database?</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/llm/">LLM</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blog/">blog</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/distributed-training/">distributed training</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/embeddings/">embeddings</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/flink/">flink</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/genai/">genai</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/github-pages/">github-pages</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/gpu/">GPU</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/inference/">inference</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/infrastructure/">infrastructure</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  
    










  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/What-Infra-does-it-take-to-train-llama405b/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1722114000"
  data-df="ll"
  
>
  Jul 28, 2024
</time>

              <h4 class="pt-0 my-2">What Infrastructure does it take to train a 405B Llama3-like model?</h4>
              <div class="text-muted">
                <p>A comprehensive overview of the infrastructure required to train 405B parameter LLMs, covering network topology, storage, compute, and fault tolerance.</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/What-Infra-does-it-take-to-train-llama405b/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>What Infrastructure does it take to train a 405B Llama3-like model?</p>
    </a>
  

  
    <a
      href="/posts/Spegel-stateless-local-OCI-mirror/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>Spegel - Stateless Local OCI Mirror</p>
    </a>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2026</time>

    
      <a href="https://twitter.com/tremooo">Tremo Ahmed</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.4.1"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/llm/">LLM</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blog/">blog</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/distributed-training/">distributed training</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/embeddings/">embeddings</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/flink/">flink</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/genai/">genai</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/github-pages/">github-pages</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/gpu/">GPU</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/inference/">inference</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/infrastructure/">infrastructure</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script>
  (function () {
    const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed');
    const initTheme = themeMapper[Theme.visualState];

    let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) {
      lang = lang.slice(0, 2);
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'tremo1/tremo1.github.io',
      'data-repo-id': 'R_kgDOJp3hDw',
      'data-category': 'General',
      'data-category-id': 'DIC_kwDOJp3hD84C007K',
      'data-mapping': 'pathname',
      'data-strict' : '0',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': lang,
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusNode = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusNode.setAttribute(key, value)
    );

    const $footer = document.querySelector('footer');
    $footer.insertAdjacentElement("beforebegin", giscusNode);

    addEventListener('message', (event) => {
      if (event.source === window && event.data && event.data.id === Theme.ID) {
        const newTheme = themeMapper[Theme.visualState];

        const message = {
          setConfig: {
            theme: newTheme
          }
        };

        const giscus =
          document.getElementsByClassName('giscus-frame')[0].contentWindow;
        giscus.postMessage({ giscus: message }, 'https://giscus.app');
      }
    });
  })();
</script>



    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

